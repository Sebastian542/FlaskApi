<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Ferretería Mejorada</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
        h1 { color: #2c3e50; }
        h2 { border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 30px; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #3498db; color: white; }
        form { margin-bottom: 40px; background: white; padding: 20px; border-radius: 8px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
        button { margin-top: 15px; padding: 10px 20px; background-color: #3498db; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #2980b9; }
        .section { margin-bottom: 50px; }
    </style>
</head>
<body>

    <h1>Ferretería Mejorada</h1>

    <div class="section">
        <form action="/agregar_producto" method="post">
            <h2>Agregar Producto</h2>
            <label>Nombre</label>
            <input type="text" name="nombre" required />
            <label>Descripción</label>
            <textarea name="descripcion" rows="2"></textarea>
            <label>Stock</label>
            <input type="number" name="stock" min="0" required />
            <label>Precio</label>
            <input type="number" step="0.01" name="precio" min="0" required />
            <label>Categoría</label>
            <select name="id_categoria" required>
                <option value="">--Seleccione--</option>
                {% for categoria in categorias %}
                    <option value="{{ categoria.id }}">{{ categoria.nombre_categoria }}</option>
                {% endfor %}
            </select>
            <button type="submit">Agregar Producto</button>
        </form>

        <h2>Lista de Productos</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th><th>Nombre</th><th>Descripción</th><th>Stock</th><th>Precio</th><th>Categoría</th>
                </tr>
            </thead>
            <tbody>
                {% for p in productos %}
                <tr>
                    <td>{{ p.id }}</td>
                    <td>{{ p.nombre }}</td>
                    <td>{{ p.descripcion }}</td>
                    <td>{{ p.stock }}</td>
                    <td>{{ "%.2f"|format(p.precio) }}</td>
                    <td>{{ p.categoria.nombre_categoria if p.categoria else 'N/A' }}</td>
                </tr>
                {% else %}
                <tr><td colspan="6">No hay productos.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="section">
        <form action="/agregar_cliente" method="post">
            <h2>Agregar Cliente</h2>
            <label>Nombre Completo</label>
            <input type="text" name="nombre_completo" required />
            <label>Teléfono</label>
            <input type="text" name="telefono" />
            <label>Email</label>
            <input type="email" name="email" />
            <label>Dirección</label>
            <input type="text" name="direccion" />
            <label>Documento</label>
            <input type="text" name="documento" />
            <label>Tipo Cliente (ID)</label>
            <input type="number" name="tipo_cliente_id" />
            <button type="submit">Agregar Cliente</button>
        </form>

        <h2>Lista de Clientes</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th><th>Nombre Completo</th><th>Teléfono</th><th>Email</th><th>Dirección</th><th>Documento</th><th>Tipo Cliente</th>
                </tr>
            </thead>
            <tbody>
                {% for c in clientes %}
                <tr>
                    <td>{{ c.id }}</td>
                    <td>{{ c.nombre_completo }}</td>
                    <td>{{ c.telefono }}</td>
                    <td>{{ c.email }}</td>
                    <td>{{ c.direccion }}</td>
                    <td>{{ c.documento }}</td>
                    <td>{{ c.tipo_cliente_id }}</td>
                </tr>
                {% else %}
                <tr><td colspan="7">No hay clientes.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="section">
        <form action="/agregar_categoria" method="post">
            <h2>Agregar Categoría</h2>
            <label>Nombre Categoría</label>
            <input type="text" name="nombre_categoria" required />
            <button type="submit">Agregar Categoría</button>
        </form>

        <h2>Lista de Categorías</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th><th>Nombre Categoría</th>
                </tr>
            </thead>
            <tbody>
                {% for cat in categorias %}
                <tr>
                    <td>{{ cat.id }}</td>
                    <td>{{ cat.nombre_categoria }}</td>
                </tr>
                {% else %}
                <tr><td colspan="2">No hay categorías.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="section">
        <form action="/crear_factura" method="post">
            <h2>Crear Factura</h2>
            <label>Cliente</label>
            <select name="id_cliente" required>
                <option value="">--Seleccione--</option>
                {% for cliente in clientes %}
                    <option value="{{ cliente.id }}">{{ cliente.nombre_completo }}</option>
                {% endfor %}
            </select>
            <label>Método de Pago</label>
            <input type="text" name="metodo_pago" required />
            <label>Estado (ID)</label>
            <input type="number" name="id_estado" />
            <label>Total Factura</label>
            <input type="number" step="0.01" name="total_facturas" min="0" required />
            <button type="submit">Crear Factura</button>
        </form>

        <h2>Lista de Facturas</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th><th>Cliente</th><th>Método Pago</th><th>Estado</th><th>Total Factura</th>
                </tr>
            </thead>
            <tbody>
                {% for f in facturas %}
                <tr>
                    <td>{{ f.id }}</td>
                    <td>{{ f.cliente.nombre_completo if f.cliente else 'N/A' }}</td>
                    <td>{{ f.metodo_pago }}</td>
                    <td>{{ f.id_estado }}</td>
                    <td>{{ "%.2f"|format(f.total_facturas) }}</td>
                </tr>
                {% else %}
                <tr><td colspan="5">No hay facturas.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="section">
        <form action="/agregar_resena" method="post">
            <h2>Agregar Reseña</h2>
            <label>Producto</label>
            <select name="producto_id" required>
                <option value="">--Seleccione--</option>
                {% for producto in productos %}
                    <option value="{{ producto.id }}">{{ producto.nombre }}</option>
                {% endfor %}
            </select>
            <label>Cliente</label>
            <select name="cliente_id" required>
                <option value="">--Seleccione--</option>
                {% for cliente in clientes %}
                    <option value="{{ cliente.id }}">{{ cliente.nombre_completo }}</option>
                {% endfor %}
            </select>
            <label>Comentario</label>
            <textarea name="comentario" rows="3" required></textarea>
            <label>Puntuación (1 a 5)</label>
            <input type="number" name="puntuacion" min="1" max="5" required />
            <button type="submit">Agregar Reseña</button>
        </form>

        <h2>Lista de Reseñas</h2>
        <table>
            <thead>
                <tr>
                    <th>ID</th><th>Producto</th><th>Cliente</th><th>Comentario</th><th>Puntuación</th>
                </tr>
            </thead>
            <tbody>
                {% for r in resenas %}
                <tr>
                    <td>{{ r.id }}</td>
                    <td>{{ r.producto.nombre if r.producto else 'N/A' }}</td>
                    <td>{{ r.cliente.nombre_completo if r.cliente else 'N/A' }}</td>
                    <td>{{ r.comentario }}</td>
                    <td>{{ r.puntuacion }}</td>
                </tr>
                {% else %}
                <tr><td colspan="5">No hay reseñas.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</body>
</html>
