<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Ferretería - Gestión Completa</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h2 {
            border-bottom: 2px solid #444;
            padding-bottom: 5px;
        }
        section {
            margin-bottom: 40px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #999;
            padding: 6px;
            text-align: left;
        }
        form {
            margin-top: 10px;
            margin-bottom: 20px;
        }
        input[type=text], input[type=email], input[type=number], input[type=date], input[type=password] {
            padding: 5px;
            margin-right: 10px;
            width: 150px;
        }
        button {
            padding: 5px 12px;
        }
        .btn-delete {
            background-color: #c00;
            color: white;
            border: none;
            cursor: pointer;
            padding: 3px 7px;
        }
        .btn-delete:hover {
            background-color: #900;
        }
        .form-inline input {
            width: auto;
        }
    </style>
</head>
<body>

    <h1>Gestión Ferretería - CRUD Completo</h1>

    <!-- USUARIOS -->
    <section id="usuarios">
        <h2>Usuarios</h2>

        <!-- Tabla usuarios -->
        <table>
            <thead>
                <tr><th>ID</th><th>Nombre</th><th>Email</th><th>Password</th><th>Acciones</th></tr>
            </thead>
            <tbody>
                {% for u in usuarios %}
                <tr>
                    <td>{{ u.id }}</td>
                    <td>{{ u.nombre }}</td>
                    <td>{{ u.email }}</td>
                    <td>{{ u.password }}</td>
                    <td>
                        <form style="display:inline" action="{{ url_for('usuarios_eliminar', id=u.id) }}" method="POST" onsubmit="return confirm('Eliminar usuario?');">
                            <button class="btn-delete" type="submit">Eliminar</button>
                        </form>
                        <a href="{{ url_for('usuarios_editar', id=u.id) }}">Editar</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Form agregar usuario -->
        <form action="{{ url_for('usuarios_agregar') }}" method="POST" class="form-inline">
            <input name="nombre" type="text" placeholder="Nombre" required />
            <input name="email" type="email" placeholder="Email" required />
            <input name="password" type="password" placeholder="Password" required />
            <button type="submit">Agregar Usuario</button>
        </form>
    </section>

    <!-- PRODUCTOS -->
    <section id="productos">
        <h2>Productos</h2>

        <table>
            <thead>
                <tr><th>ID</th><th>Nombre</th><th>Descripción</th><th>Precio</th><th>Stock</th><th>Acciones</th></tr>
            </thead>
            <tbody>
                {% for p in productos %}
                <tr>
                    <td>{{ p.id }}</td>
                    <td>{{ p.nombre }}</td>
                    <td>{{ p.descripcion }}</td>
                    <td>{{ p.precio }}</td>
                    <td>{{ p.stock }}</td>
                    <td>
                        <form style="display:inline" action="{{ url_for('productos_eliminar', id=p.id) }}" method="POST" onsubmit="return confirm('Eliminar producto?');">
                            <button class="btn-delete" type="submit">Eliminar</button>
                        </form>
                        <a href="{{ url_for('productos_editar', id=p.id) }}">Editar</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <form action="{{ url_for('productos_agregar') }}" method="POST" class="form-inline">
            <input name="nombre" type="text" placeholder="Nombre" required />
            <input name="descripcion" type="text" placeholder="Descripción" required />
            <input name="precio" type="number" step="0.01" placeholder="Precio" required />
            <input name="stock" type="number" placeholder="Stock" required />
            <button type="submit">Agregar Producto</button>
        </form>
    </section>

    <!-- CLIENTES -->
    <section id="clientes">
        <h2>Clientes</h2>

        <table>
            <thead>
                <tr><th>ID</th><th>Nombre</th><th>Email</th><th>Teléfono</th><th>Acciones</th></tr>
            </thead>
            <tbody>
                {% for c in clientes %}
                <tr>
                    <td>{{ c.id }}</td>
                    <td>{{ c.nombre }}</td>
                    <td>{{ c.email }}</td>
                    <td>{{ c.telefono }}</td>
                    <td>
                        <form style="display:inline" action="{{ url_for('clientes_eliminar', id=c.id) }}" method="POST" onsubmit="return confirm('Eliminar cliente?');">
                            <button class="btn-delete" type="submit">Eliminar</button>
                        </form>
                        <a href="{{ url_for('clientes_editar', id=c.id) }}">Editar</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <form action="{{ url_for('clientes_agregar') }}" method="POST" class="form-inline">
            <input name="nombre" type="text" placeholder="Nombre" required />
            <input name="email" type="email" placeholder="Email" required />
            <input name="telefono" type="text" placeholder="Teléfono" required />
            <button type="submit">Agregar Cliente</button>
        </form>
    </section>

    <!-- VENTAS -->
    <section id="ventas">
        <h2>Ventas</h2>

        <table>
            <thead>
                <tr><th>ID</th><th>Cliente</th><th>Fecha</th><th>Acciones</th></tr>
            </thead>
            <tbody>
                {% for v in ventas %}
                <tr>
                    <td>{{ v.id }}</td>
                    <td>
                        {% for c in clientes %}
                            {% if c.id == v.id_cliente %}
                                {{ c.nombre }}
                            {% endif %}
                        {% endfor %}
                    </td>
                    <td>{{ v.fecha }}</td>
                    <td>
                        <form style="display:inline" action="{{ url_for('ventas_eliminar', id=v.id) }}" method="POST" onsubmit="return confirm('Eliminar venta?');">
                            <button class="btn-delete" type="submit">Eliminar</button>
                        </form>
                        <a href="{{ url_for('ventas_editar', id=v.id) }}">Editar</a> |
                        <a href="{{ url_for('detalle_venta', id_venta=v.id) }}">Detalle</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <form action="{{ url_for('ventas_agregar') }}" method="POST" class="form-inline">
            <select name="id_cliente" required>
                <option value="" disabled selected>Seleccione Cliente</option>
                {% for c in clientes %}
                <option value="{{ c.id }}">{{ c.nombre }}</option>
                {% endfor %}
            </select>
            <input name="fecha" type="date" required />
            <button type="submit">Agregar Venta</button>
        </form>
    </section>

    <!-- DETALLE VENTA -->
    {% if detalles is defined and id_venta is defined and productos is defined %}
    <section id="detalle_venta">
        <h2>Detalle Venta #{{ id_venta }}</h2>

        <table>
            <thead>
                <tr><th>ID</th><th>Producto</th><th>Cantidad</th><th>Precio Venta</th><th>Acciones</th></tr>
            </thead>
            <tbody>
                {% for d in detalles %}
                <tr>
                    <td>{{ d.id }}</td>
                    <td>{{ d.producto }}</td>
                    <td>{{ d.cantidad }}</td>
                    <td>{{ d.precio_venta }}</td>
                    <td>
                        <form style="display:inline" action="{{ url_for('detalle_eliminar', id_venta=id_venta, id_detalle=d.id) }}" method="POST" onsubmit="return confirm('Eliminar detalle?');">
                            <button class="btn-delete" type="submit">Eliminar</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <form action="{{ url_for('detalle_agregar', id_venta=id_venta) }}" method="POST" class="form-inline">
            <select name="id_producto" required>
                <option value="" disabled selected>Seleccione Producto</option>
                {% for p in productos %}
                <option value="{{ p.id }}">{{ p.nombre }}</option>
                {% endfor %}
            </select>
            <input name="cantidad" type="number" min="1" required />
            <input name="precio_venta" type="number" step="0.01" min="0" required />
            <button type="submit">Agregar Detalle</button>
        </form>

        <a href="{{ url_for('index') }}">Volver al Inicio</a>
    </section>
    {% endif %}

</body>
</html>
